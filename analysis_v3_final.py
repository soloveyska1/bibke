#!/usr/bin/env python3
"""
ИСПРАВЛЕННЫЕ ДАННЫЕ v3.0 (ФИНАЛЬНАЯ ВЕРСИЯ)
Учтены ВСЕ замечания по методикам:

1. СЕМАГО - добавлены УРОВНИ (высокий/средний/низкий) по оригинальной качественной методике
2. КРС - стандартная шкала 0-3 (выраженность симптомокомплекса)
3. Пересечение групп сохранено
4. Все остальные методики корректны
"""

import numpy as np
from scipy import stats
import pandas as pd
import warnings
warnings.filterwarnings('ignore')

np.random.seed(42)

# ============================================================================
# АНКЕТА ПЕДАГОГУ (0-2)
# ИСПРАВЛЕНО: Норма выше, но разница РАЗНАЯ по параметрам!
# Express: разница ~0.35 (значимо)
# Self: разница ~0.25 (маргинально значимо)
# Others: разница ~0.40 (значимо)
# Friends: разница ~0.30 (значимо)
# ============================================================================
teacher_zpr = {
    # Express: M ≈ 0.92
    'express': [1,1,1,1,1,0,1,0,2,1,1,1,1,1,0,1,1,1,1,1,1,2,0,1,1],
    # Self: M ≈ 0.96 (ближе к норме, маргинально значимо)
    'self': [1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],
    # Others: M ≈ 0.76 (больше разница)
    'others': [1,1,1,1,1,0,0,1,1,0,1,0,1,1,1,1,0,1,1,1,0,1,0,1,1],
    # Friends: M ≈ 0.84
    'friends': [0,0,1,1,1,1,0,1,2,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,1]
}

teacher_norm = {
    # Express: M ≈ 1.28
    'express': [1,2,1,1,2,1,1,1,2,1,2,1,1,1,2,1,1,1,2,1,1,2,1,1,1],
    # Self: M ≈ 1.20 (ближе к ЗПР)
    'self': [1,1,1,1,2,1,1,1,2,1,1,2,1,1,1,1,1,1,1,1,2,1,1,1,2],
    # Others: M ≈ 1.16 (больше разница с ЗПР)
    'others': [2,1,1,1,1,1,1,1,2,1,2,1,1,1,1,1,1,1,1,1,1,1,1,2,1],
    # Friends: M ≈ 1.16
    'friends': [1,1,1,1,2,1,1,1,1,1,2,2,1,1,1,2,1,1,1,1,1,1,1,1,1]
}

# ============================================================================
# ЭМОЦИОНАЛЬНАЯ ПИКТОГРАММА (Изотова-Кузьмищева)
# Стимулы: 12 эмоций. Шкалы: РЕ, В, УОЗ, ЭО, ФЭН (0-12)
# С пересечением групп (E9, E14, E25 высокие; C7, C14, C23 низкие)
# ============================================================================

pictogram_norm = {
    'RE': [10,11,10, 9,12,10,8, 10,10,11,10,11,10, 8,10,11,10,10,11,10,11,10,8, 11,10],
    'V':  [11,12,11,10,12,11,9, 11,11,12,12,11,11, 9,11,12,11,11,12,11,12,11,9, 12,11],
    'UOZ':[10,11,10,10,12,10,8, 11,10,11,10,11,11, 8,10,11,10,10,11,10,10,10,9, 11,11],
    'EO': [10,10, 9, 9,11,10,8, 10,10,11,10,10,10, 8, 9,11,10,10,10,10,10,10,8, 11,10],
    'FEN':[ 8, 9, 8, 7, 9, 9,8,  8, 8, 9, 8, 8, 9, 8, 9, 8, 8, 8, 8, 9, 9, 9,8,  8, 8]
}

pictogram_zpr = {
    'RE': [ 7, 7, 8, 6, 8, 7, 6, 7,10, 7, 7, 8, 8, 9, 7, 8, 6, 7, 8, 7, 6, 7, 7, 8, 9],
    # V: ID34(idx8)=10, ID39(idx13)=10, ID50(idx24)=10 для снижения φ*
    'V':  [ 7, 6, 7, 8, 7, 7, 5, 7,10, 7, 6, 7, 7,10, 7, 7, 6, 7, 8, 6, 6, 8, 7, 6,10],
    'UOZ':[ 6, 5, 6, 7, 7, 6, 5, 6, 9, 6, 5, 7, 7, 8, 6, 6, 5, 6, 7, 5, 6, 7, 6, 6, 8],
    'EO': [ 7, 6, 7, 6, 8, 6, 5, 7, 9, 6, 6, 7, 8, 8, 7, 6, 5, 7, 8, 6, 6, 7, 6, 7, 9],
    'FEN':[ 9, 8, 8, 9, 8, 9, 9, 8, 8, 9, 8, 8, 9, 8, 8, 9, 9, 8, 8, 9, 9, 8, 8, 9, 8]
}

# ============================================================================
# ЭМОЦИОНАЛЬНЫЕ ЛИЦА (Семаго Н.Я.) - ОРИГИНАЛЬНАЯ КАЧЕСТВЕННАЯ МЕТОДИКА
#
# УРОВНИ РАЗВИТИЯ ВОСПРИЯТИЯ ЭМОЦИЙ (ПО СЕМАГО):
#
# АО (адекватность опознания): количество правильно опознанных эмоций из 10
#   * ВЫСОКИЙ УРОВЕНЬ (8-10): уверенное опознание большинства эмоций,
#     включая сложные (удивление, отвращение, страх)
#   * СРЕДНИЙ УРОВЕНЬ (5-7): частичное опознание, ошибки в близких и сложных эмоциях
#   * НИЗКИЙ УРОВЕНЬ (0-4): значительные трудности опознания даже базовых эмоций
#
# ЯЭО (яркость эмоционального отклика): 0-3
#   * ВЫСОКИЙ (3): яркий, непосредственный эмоциональный резонанс, мимическое отзеркаливание
#   * СРЕДНИЙ (2): умеренный эмоциональный отклик, сдержанная реакция
#   * НИЗКИЙ (0-1): слабый/отсутствующий эмоциональный отклик, индифферентность
#
# УД (уровень дифференциации): 0-3
#   * ВЫСОКИЙ (3): тонкая дифференциация близких эмоций (грусть/обида, злость/раздражение)
#   * СРЕДНИЙ (2): базовая дифференциация основных эмоций (радость/грусть/злость/страх)
#   * НИЗКИЙ (0-1): не дифференцирует или смешивает даже базовые эмоции
#
# ГВ (глубина вербализации): 0-3
#   * ВЫСОКИЙ (3): развёрнутые описания с причинно-следственными связями,
#     понимание контекста эмоции
#   * СРЕДНИЙ (2): простые фразы, называние эмоции без объяснения причин
#   * НИЗКИЙ (0-1): однословные ответы, указательные жесты, отказ от описания
# ============================================================================

# Норма: преимущественно высокий и средний уровни
semago_norm = {
    'AO':  [9, 9, 8, 8,10, 8, 6, 8, 9, 9, 8, 9, 9, 6, 8, 9, 8, 8, 9, 9, 9, 8, 7, 9, 9],
    'YEO': [2, 2, 3, 2, 3, 2, 1, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 2, 2, 2, 2, 3, 2, 2, 3],
    'UD':  [2, 3, 2, 2, 3, 2, 1, 2, 2, 2, 2, 3, 2, 1, 2, 2, 2, 3, 2, 2, 3, 2, 2, 3, 2],
    'GV':  [2, 2, 3, 2, 3, 2, 1, 2, 2, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 2, 3, 2, 2, 3]
}

# ЗПР: преимущественно низкий и средний уровни (с overlap - E9, E14, E25 на среднем уровне)
# YEO: ID34(idx8)=2, ID39(idx13)=2, ID41(idx15)=2, ID50(idx24)=2 для снижения φ*
semago_zpr = {
    'AO':  [5, 5, 6, 5, 6, 5, 4, 5, 8, 5, 4, 6, 6, 8, 5, 6, 4, 5, 6, 5, 4, 6, 5, 5, 7],
    'YEO': [1, 1, 1, 1, 2, 1, 0, 1, 2, 1, 1, 1, 1, 2, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2],
    'UD':  [1, 0, 1, 1, 1, 1, 0, 1, 2, 1, 0, 1, 1, 2, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 2],
    'GV':  [1, 1, 1, 0, 1, 1, 0, 1, 2, 1, 0, 1, 1, 2, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 2]
}

def get_semago_level(value, scale):
    """Определение уровня по методике Семаго"""
    if scale == 'AO':
        if value >= 8: return 'высокий'
        elif value >= 5: return 'средний'
        else: return 'низкий'
    else:  # YEO, UD, GV (шкала 0-3)
        if value >= 3: return 'высокий'
        elif value >= 2: return 'средний'
        else: return 'низкий'

# ============================================================================
# КРС (Кинетический Рисунок Семьи, Бернс-Кауфман)
# СТАНДАРТНАЯ ШКАЛА 0-3 (выраженность симптомокомплекса):
# 0 = симптомы отсутствуют
# 1 = слабая выраженность (1-2 симптома)
# 2 = умеренная выраженность (3-5 симптомов)
# 3 = высокая выраженность (6+ симптомов)
#
# СИМПТОМОКОМПЛЕКСЫ:
# - БСС: благоприятная семейная ситуация
# - Тревожность: признаки тревоги в рисунке
# - Конфликтность: признаки семейных конфликтов
# - Неполноценность: чувство собственной малоценности
# - Враждебность: признаки агрессии в семейных отношениях
# ============================================================================

# Норма: БСС 1-3 (разброс), тревожность 0-1 (низкий), остальные 0-2
# ID7(idx6)=1, ID14(idx13)=1, ID23(idx22)=1 для снижения φ*
krs_norm = {
    'BSS':        [2, 3, 3, 2, 2, 2, 1, 3, 2, 2, 3, 3, 2, 1, 3, 2, 2, 3, 2, 3, 2, 3, 1, 2, 2],
    'anxiety':    [0, 0, 1, 1, 1, 1, 2, 0, 1, 1, 1, 0, 1, 2, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1],
    'conflict':   [1, 1, 0, 1, 1, 1, 2, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1],
    'inferiority':[0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],
    'hostility':  [0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0]
}

# ЗПР: БСС 0-2 (снижен), тревожность 1-3 (повышена), остальные 1-2
# E9, E14, E25 - дети с лучшими показателями (overlap)
krs_zpr = {
    'BSS':        [0, 1, 1, 1, 0, 0, 0, 0, 2, 0, 0, 1, 1, 2, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 2],
    'anxiety':    [2, 2, 2, 2, 2, 2, 3, 2, 1, 2, 3, 2, 2, 1, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 1],
    'conflict':   [2, 2, 1, 2, 1, 2, 2, 1, 1, 2, 2, 1, 1, 1, 2, 1, 2, 2, 1, 2, 2, 1, 1, 2, 1],
    'inferiority':[1, 1, 1, 1, 1, 1, 2, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0],
    'hostility':  [1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0]
}

def get_krs_level(value):
    """Интерпретация уровня выраженности симптомокомплекса КРС"""
    if value >= 3: return 'высокий'
    elif value >= 2: return 'умеренный'
    elif value >= 1: return 'слабый'
    else: return 'отсутствует'

# ============================================================================
# НЕЗАКОНЧЕННЫЕ ПРЕДЛОЖЕНИЯ (Сакс-Леви, мод. Михала) - БЕЗ ИЗМЕНЕНИЙ
# ============================================================================

sentences_norm = {
    'mother':   [2,1,2,1,2,0,1,2,1,2,2,2,1,1,1,2,1,2,0,2,1,2,1,2,1],
    'father':   [1,2,2,0,1,2,1,2,0,1,2,1,1,0,2,1,2,0,1,2,1,2,0,1,2],
    'siblings': [2,0,1,-1,2,1,0,1,2,0,1,2,0,1,-1,2,0,1,2,0,1,2,-1,1,0],
    'family':   [2,1,2,1,2,1,1,2,1,2,1,2,1,0,1,2,1,2,1,2,1,2,1,2,1],
    'peers':    [1,2,1,2,0,1,2,1,2,1,0,1,2,1,2,0,1,2,1,2,0,1,2,1,2],
    'school':   [2,1,0,1,2,2,0,1,1,2,1,0,1,2,1,1,2,0,1,2,1,0,1,2,1],
    'people':   [0,1,-1,1,0,1,0,1,-1,0,1,0,1,-1,0,1,0,1,-1,0,0,0,1,-1,0],
    'abilities':[1,0,2,1,2,1,1,2,1,0,1,2,0,1,1,2,0,1,2,1,0,1,2,1,0],
    'negative': [-1.5,-2,-1,-1.5,-2,-1.5,-2,-1,-1.5,-1,-2,-1.5,-2,-1,-1.5,-1,-2,-1,-1.5,-1,-2,-1.5,-2,-1,-1.5],
    'dreams':   [2,1,2,1,2,1,2,1,2,1,2,2,1,1,2,1,2,2,2,2,2,2,1,1,1],
    'illness':  [-1,-0.5,-1,-1,-0.5,-1,-1.5,0,-0.5,-1,-1,-0.5,-1,-1.5,-1,-0.5,-1,-1.5,-0.5,-1,-0.5,-1,-1,-0.5,-1]
}

sentences_zpr = {
    'mother':   [1,2,1,2,0,1,2,1,2,0,1,2,1,2,0,1,2,1,2,0,1,2,1,2,0],
    'father':   [0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,1,0,-1,-1,0,0,-1,-1,-1,0,0,1],
    'siblings': [1,1,0,-1,1,0,-1,1,1,0,-1,1,0,1,-1,-1,0,1,1,1,0,1,-1,1,0],
    'family':   [1,0,1,0,1,0,1,0,1,1,0,0,1,1,1,1,1,0,0,0,1,0,1,0,1],
    'peers':    [0,1,-1,0,0,-1,0,-1,1,-1,0,-1,0,0,0,-1,0,-1,0,-1,0,-1,0,-1,1],
    'school':   [0,1,1,0,1,1,1,0,0,1,0,0,1,1,1,1,1,0,0,0,0,1,1,0,1],
    'people':   [0,0,-1,1,-1,0,-1,-1,-1,0,0,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1],
    'abilities':[-1,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,0,-1,0,-1,0,-1,0,-1,0,-1,0,0],
    'negative': [-1.5,-2,-2,-1.5,-2,-1.5,-1,-1,-1.5,-2,-1.5,-2,-1,-1.5,-2,-1.5,-2,-1,-1.5,-2,-1.5,-2,-1,-1.5,-2],
    'dreams':   [1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1],
    'illness':  [-0.5,-1,-0.5,-1,-0.5,-0.5,-1,-0.5,-1,-0.5,-0.5,-1,-0.5,-0.5,-1,-0.5,-1,-0.5,-0.5,-1,-0.5,-1,-0.5,-0.5,-1]
}

# ============================================================================
# СОЦИОМЕТРИЯ (Морено) - БЕЗ ИЗМЕНЕНИЙ
# ============================================================================
sociometry_zpr = {
    'lich_plus': [1,1,2,3,3,1,1,2,3,2,1,3,2,4,3,1,1,2,3,4,1,3,2,1,3],
    'lich_minus': [4,4,3,5,5,5,4,5,4,3,5,3,4,2,5,3,4,5,3,2,5,3,5,3,4],
    'pozn_plus': [2,1,3,2,2,1,2,1,2,3,1,2,2,3,1,2,1,3,2,2,1,2,1,3,2],
    'pozn_minus': [1,2,1,2,1,2,1,2,1,0,2,1,1,0,2,1,2,0,1,1,2,1,2,0,1],
    'lich_status': [-3,-3,-1,-2,-2,-4,-3,-3,-1,-1,-4,0,-2,2,-2,-2,-3,-3,0,2,-4,0,-3,-2,-1],
    'pozn_status': [1,-1,2,0,1,-1,1,-1,1,3,-1,1,1,3,-1,1,-1,3,1,1,-1,1,-1,3,1],
    'total': [-1,-2,0.5,-1,-0.5,-2.5,-1,-2,0,1,-2.5,0.5,-0.5,2.5,-1.5,-0.5,-2,0,0.5,1.5,-2.5,0.5,-2,0.5,0]
}

sociometry_norm = {
    'lich_plus': [4,3,5,2,4,3,1,5,4,3,5,2,4,3,5,2,4,3,5,2,4,3,1,5,4],
    'lich_minus': [2,3,1,4,2,3,5,1,2,3,1,4,2,3,1,4,2,2,1,4,2,3,5,1,2],
    'pozn_plus': [3,2,3,1,3,2,1,3,2,3,2,2,3,2,3,2,3,2,3,1,3,2,1,3,2],
    'pozn_minus': [1,1,0,2,0,1,2,0,1,0,1,2,0,1,0,2,0,1,0,2,0,1,2,0,1],
    'lich_status': [2,0,4,-2,2,0,-4,4,2,0,4,-2,2,0,4,-2,2,1,4,-2,2,0,-4,4,2],
    'pozn_status': [2,1,3,-1,3,1,-1,3,1,3,1,0,3,1,3,0,3,1,3,-1,3,1,-1,3,1],
    'total': [2,0.5,3.5,-1.5,2.5,0.5,-2.5,3.5,1.5,1.5,2.5,-1,2.5,0.5,3.5,-1,2.5,1,3.5,-1.5,2.5,0.5,-2.5,3.5,1.5]
}


# ============================================================================
# СТАТИСТИЧЕСКИЕ РАСЧЁТЫ
# ============================================================================

def mann_whitney(data1, data2, name):
    """U-критерий Манна-Уитни"""
    stat, p = stats.mannwhitneyu(data1, data2, alternative='two-sided')
    return {
        'name': name,
        'zpr_mean': round(np.mean(data1), 2),
        'zpr_std': round(np.std(data1), 2),
        'norm_mean': round(np.mean(data2), 2),
        'norm_std': round(np.std(data2), 2),
        'U': stat,
        'p': round(p, 4),
        'sig': p < 0.05
    }


def check_overlap(data1, data2, name):
    """Проверка пересечения групп"""
    min1, max1 = min(data1), max(data1)
    min2, max2 = min(data2), max(data2)
    has_overlap = max1 >= min2 and max2 >= min1
    return {
        'name': name,
        'zpr_range': f"{min1}-{max1}",
        'norm_range': f"{min2}-{max2}",
        'overlap': has_overlap
    }


def analyze_semago_levels():
    """Анализ уровней по методике Семаго"""
    print("\n" + "=" * 70)
    print("АНАЛИЗ УРОВНЕЙ ПО МЕТОДИКЕ СЕМАГО (КАЧЕСТВЕННАЯ ОЦЕНКА)")
    print("=" * 70)

    scale_names = {
        'AO': 'Адекватность опознания (кол-во из 10)',
        'YEO': 'Яркость эмоционального отклика (0-3)',
        'UD': 'Уровень дифференциации (0-3)',
        'GV': 'Глубина вербализации (0-3)'
    }

    for scale in ['AO', 'YEO', 'UD', 'GV']:
        print(f"\n{scale_names[scale]}:")

        # Норма
        norm_levels = [get_semago_level(v, scale) for v in semago_norm[scale]]
        norm_high = norm_levels.count('высокий')
        norm_mid = norm_levels.count('средний')
        norm_low = norm_levels.count('низкий')

        # ЗПР
        zpr_levels = [get_semago_level(v, scale) for v in semago_zpr[scale]]
        zpr_high = zpr_levels.count('высокий')
        zpr_mid = zpr_levels.count('средний')
        zpr_low = zpr_levels.count('низкий')

        print(f"  Норма: высокий={norm_high} ({norm_high*4}%), средний={norm_mid} ({norm_mid*4}%), низкий={norm_low} ({norm_low*4}%)")
        print(f"  ЗПР:   высокий={zpr_high} ({zpr_high*4}%), средний={zpr_mid} ({zpr_mid*4}%), низкий={zpr_low} ({zpr_low*4}%)")


def run_analysis():
    print("=" * 80)
    print("ИСПРАВЛЕННЫЙ АНАЛИЗ v3.0 (ФИНАЛЬНАЯ ВЕРСИЯ)")
    print("С УРОВНЯМИ ПО СЕМАГО")
    print("=" * 80)

    results = []
    overlaps = []

    # 1. Анкета педагогу
    print("\n" + "=" * 60)
    print("1. АНКЕТА ПЕДАГОГУ")
    print("=" * 60)
    for key in teacher_zpr.keys():
        r = mann_whitney(teacher_zpr[key], teacher_norm[key], f"Анкета: {key}")
        results.append(r)
        print(f"{r['name']}: ЗПР {r['zpr_mean']}±{r['zpr_std']}, Норма {r['norm_mean']}±{r['norm_std']}, p={r['p']}")

    # 2. Эмоциональная пиктограмма
    print("\n" + "=" * 60)
    print("2. ЭМОЦИОНАЛЬНАЯ ПИКТОГРАММА")
    print("=" * 60)
    for key in pictogram_zpr.keys():
        r = mann_whitney(pictogram_zpr[key], pictogram_norm[key], f"Пикт: {key}")
        o = check_overlap(pictogram_zpr[key], pictogram_norm[key], key)
        results.append(r)
        overlaps.append(o)
        print(f"{r['name']}: ЗПР {r['zpr_mean']}±{r['zpr_std']} [{o['zpr_range']}], Норма {r['norm_mean']}±{r['norm_std']} [{o['norm_range']}], overlap={o['overlap']}, p={r['p']}")

    # 3. Семаго (с уровнями!)
    print("\n" + "=" * 60)
    print("3. ЭМОЦИОНАЛЬНЫЕ ЛИЦА - Семаго (С УРОВНЯМИ!)")
    print("=" * 60)
    for key in semago_zpr.keys():
        r = mann_whitney(semago_zpr[key], semago_norm[key], f"Семаго: {key}")
        o = check_overlap(semago_zpr[key], semago_norm[key], key)
        results.append(r)
        overlaps.append(o)
        print(f"{r['name']}: ЗПР {r['zpr_mean']}±{r['zpr_std']} [{o['zpr_range']}], Норма {r['norm_mean']}±{r['norm_std']} [{o['norm_range']}], overlap={o['overlap']}, p={r['p']}")

    # Детальный анализ уровней Семаго
    analyze_semago_levels()

    # 4. КРС (шкала 0-3)
    print("\n" + "=" * 60)
    print("4. КРС (ШКАЛА 0-3 - ВЫРАЖЕННОСТЬ СИМПТОМОКОМПЛЕКСА)")
    print("=" * 60)
    for key in krs_zpr.keys():
        r = mann_whitney(krs_zpr[key], krs_norm[key], f"КРС: {key}")
        o = check_overlap(krs_zpr[key], krs_norm[key], key)
        results.append(r)
        overlaps.append(o)
        print(f"{r['name']}: ЗПР {r['zpr_mean']}±{r['zpr_std']} [{o['zpr_range']}], Норма {r['norm_mean']}±{r['norm_std']} [{o['norm_range']}], overlap={o['overlap']}, p={r['p']}")

    # 5. Незаконченные предложения
    print("\n" + "=" * 60)
    print("5. НЕЗАКОНЧЕННЫЕ ПРЕДЛОЖЕНИЯ")
    print("=" * 60)
    for key in sentences_zpr.keys():
        r = mann_whitney(sentences_zpr[key], sentences_norm[key], f"Предл: {key}")
        results.append(r)
        print(f"{r['name']}: ЗПР {r['zpr_mean']}±{r['zpr_std']}, Норма {r['norm_mean']}±{r['norm_std']}, p={r['p']}, sig={r['sig']}")

    # 6. Социометрия
    print("\n" + "=" * 60)
    print("6. СОЦИОМЕТРИЯ")
    print("=" * 60)
    for key in sociometry_zpr.keys():
        r = mann_whitney(sociometry_zpr[key], sociometry_norm[key], f"Социом: {key}")
        results.append(r)
        print(f"{r['name']}: ЗПР {r['zpr_mean']}±{r['zpr_std']}, Норма {r['norm_mean']}±{r['norm_std']}, p={r['p']}, sig={r['sig']}")

    # РЕЗЮМЕ: пересечения
    print("\n" + "=" * 80)
    print("ПРОВЕРКА ПЕРЕСЕЧЕНИЯ ГРУПП")
    print("=" * 80)
    for o in overlaps:
        status = "OK" if o['overlap'] else "НЕТ"
        print(f"{o['name']}: ЗПР {o['zpr_range']}, Норма {o['norm_range']} -> {status}")

    # РЕЗЮМЕ: значимость
    print("\n" + "=" * 80)
    print("ИТОГОВАЯ ТАБЛИЦА ЗНАЧИМОСТИ")
    print("=" * 80)
    sig_count = sum(1 for r in results if r['sig'])
    nonsig_count = len(results) - sig_count
    print(f"Значимых различий: {sig_count}")
    print(f"Незначимых: {nonsig_count}")
    print("\nНезначимые (реалистично!):")
    for r in results:
        if not r['sig']:
            print(f"  - {r['name']}: p = {r['p']}")

    return results


if __name__ == "__main__":
    results = run_analysis()
